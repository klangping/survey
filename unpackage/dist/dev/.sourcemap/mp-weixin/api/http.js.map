{"version":3,"file":"http.js","sources":["api/http.js"],"sourcesContent":["const baseURL = 'http://localhost:3000/api';\n\nconst request = (options) => {\n  return new Promise((resolve, reject) => {\n    const token = uni.getStorageSync('token');\n    const headers = {\n      'Content-Type': 'application/json',\n      ...options.headers\n    };\n\n    if (token) {\n      headers['Authorization'] = `Bearer ${token}`;\n    }\n\n    let url = baseURL + options.url;\n\n    // 处理GET请求参数\n    if (options.method === 'GET' && options.data) {\n      const params = [];\n      for (const key in options.data) {\n        if (options.data[key] !== undefined) {\n          params.push(`${encodeURIComponent(key)}=${encodeURIComponent(options.data[key])}`);\n        }\n      }\n      if (params.length > 0) {\n        url += `?${params.join('&')}`;\n      }\n    }\n\n    // 设置超时时间\n    const timeout = options.timeout || 10000;\n    let timeoutTimer = setTimeout(() => {\n      reject({\n        error: '请求超时',\n        details: `请求超过${timeout}ms未响应`\n      });\n    }, timeout);\n\n    uni.request({\n      url,\n      method: options.method || 'GET',\n      data: options.method !== 'GET' ? options.data : undefined,\n      header: headers,\n      success: (res) => {\n        clearTimeout(timeoutTimer);\n        \n        // 处理401未授权\n        if (res.statusCode === 401) {\n          uni.removeStorageSync('token');\n          uni.removeStorageSync('user');\n          uni.showToast({\n            title: '登录已过期，请重新登录',\n            icon: 'none'\n          });\n          setTimeout(() => {\n            uni.reLaunch({ url: '/pages/auth/login' });\n          }, 1500);\n          return;\n        }\n        \n        if (res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(res.data);\n        } else {\n          reject(res.data || {\n            error: `请求失败: ${res.statusCode}`,\n            message: res.data?.message || '请求失败'\n          });\n        }\n      },\n      fail: (err) => {\n        clearTimeout(timeoutTimer);\n        reject({\n          error: '网络错误',\n          details: err.errMsg || err\n        });\n      }\n    });\n  });\n};\n\nconst http = {\n  get(url, params, options = {}) {\n    return request({\n      url,\n      method: 'GET',\n      data: params,\n      ...options\n    });\n  },\n  post(url, data, options = {}) {\n    return request({\n      url,\n      method: 'POST',\n      data,\n      ...options\n    });\n  },\n  put(url, data, options = {}) {\n    return request({\n      url,\n      method: 'PUT',\n      data,\n      ...options\n    });\n  },\n  delete(url, options = {}) {\n    return request({\n      url,\n      method: 'DELETE',\n      ...options\n    });\n  }\n};\n\nexport default http;"],"names":["uni"],"mappings":";;AAAA,MAAM,UAAU;AAEhB,MAAM,UAAU,CAAC,YAAY;AAC3B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,UAAU;AAAA,MACd,gBAAgB;AAAA,MAChB,GAAG,QAAQ;AAAA,IACjB;AAEI,QAAI,OAAO;AACT,cAAQ,eAAe,IAAI,UAAU,KAAK;AAAA,IAC3C;AAED,QAAI,MAAM,UAAU,QAAQ;AAG5B,QAAI,QAAQ,WAAW,SAAS,QAAQ,MAAM;AAC5C,YAAM,SAAS,CAAA;AACf,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI,QAAQ,KAAK,GAAG,MAAM,QAAW;AACnC,iBAAO,KAAK,GAAG,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,QAAQ,KAAK,GAAG,CAAC,CAAC,EAAE;AAAA,QAClF;AAAA,MACF;AACD,UAAI,OAAO,SAAS,GAAG;AACrB,eAAO,IAAI,OAAO,KAAK,GAAG,CAAC;AAAA,MAC5B;AAAA,IACF;AAGD,UAAM,UAAU,QAAQ,WAAW;AACnC,QAAI,eAAe,WAAW,MAAM;AAClC,aAAO;AAAA,QACL,OAAO;AAAA,QACP,SAAS,OAAO,OAAO;AAAA,MAC/B,CAAO;AAAA,IACF,GAAE,OAAO;AAEVA,kBAAAA,MAAI,QAAQ;AAAA,MACV;AAAA,MACA,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,WAAW,QAAQ,QAAQ,OAAO;AAAA,MAChD,QAAQ;AAAA,MACR,SAAS,CAAC,QAAQ;;AAChB,qBAAa,YAAY;AAGzB,YAAI,IAAI,eAAe,KAAK;AAC1BA,8BAAI,kBAAkB,OAAO;AAC7BA,8BAAI,kBAAkB,MAAM;AAC5BA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AACD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,SAAS,EAAE,KAAK,oBAAqB,CAAA;AAAA,UAC1C,GAAE,IAAI;AACP;AAAA,QACD;AAED,YAAI,IAAI,cAAc,OAAO,IAAI,aAAa,KAAK;AACjD,kBAAQ,IAAI,IAAI;AAAA,QAC1B,OAAe;AACL,iBAAO,IAAI,QAAQ;AAAA,YACjB,OAAO,SAAS,IAAI,UAAU;AAAA,YAC9B,WAAS,SAAI,SAAJ,mBAAU,YAAW;AAAA,UAC1C,CAAW;AAAA,QACF;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,qBAAa,YAAY;AACzB,eAAO;AAAA,UACL,OAAO;AAAA,UACP,SAAS,IAAI,UAAU;AAAA,QACjC,CAAS;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAEK,MAAC,OAAO;AAAA,EACX,IAAI,KAAK,QAAQ,UAAU,CAAA,GAAI;AAC7B,WAAO,QAAQ;AAAA,MACb;AAAA,MACA,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,GAAG;AAAA,IACT,CAAK;AAAA,EACF;AAAA,EACD,KAAK,KAAK,MAAM,UAAU,CAAA,GAAI;AAC5B,WAAO,QAAQ;AAAA,MACb;AAAA,MACA,QAAQ;AAAA,MACR;AAAA,MACA,GAAG;AAAA,IACT,CAAK;AAAA,EACF;AAAA,EACD,IAAI,KAAK,MAAM,UAAU,CAAA,GAAI;AAC3B,WAAO,QAAQ;AAAA,MACb;AAAA,MACA,QAAQ;AAAA,MACR;AAAA,MACA,GAAG;AAAA,IACT,CAAK;AAAA,EACF;AAAA,EACD,OAAO,KAAK,UAAU,IAAI;AACxB,WAAO,QAAQ;AAAA,MACb;AAAA,MACA,QAAQ;AAAA,MACR,GAAG;AAAA,IACT,CAAK;AAAA,EACF;AACH;;"}